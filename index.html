<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employee Portal - WeOne</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
        :root {
            --primary-color: #4361ee;
            --primary-light: #4cc9f0;
            --secondary-color: #7209b7;
            --success-color: #4ad66d;
            --info-color: #4895ef;
            --warning-color: #f8961e;
            --danger-color: #f94144;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --text-dark: #2b2d42;
            --text-light: #8d99ae;
            --bg-gradient: linear-gradient(135deg, #f5f7fa 0%, #e9ecef 100%);
            --card-gradient: linear-gradient(to bottom right, #ffffff, #f8f9fa);
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--bg-gradient);
            color: var(--text-dark);
            line-height: 1.6;
            padding-bottom: 80px;
            min-height: 100vh;
        }
        
        /* Neumorphic Elements */
        .neumorphic {
            background: var(--card-gradient);
            border-radius: 16px;
            box-shadow: 
                8px 8px 16px rgba(163, 177, 198, 0.3),
                -8px -8px 16px rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .neumorphic:hover {
            box-shadow: 
                12px 12px 24px rgba(163, 177, 198, 0.4),
                -12px -12px 24px rgba(255, 255, 255, 0.9);
            transform: translateY(-2px);
        }
        
        .neumorphic-flat {
            background: var(--card-gradient);
            border-radius: 12px;
            box-shadow: 
                4px 4px 8px rgba(163, 177, 198, 0.2),
                -4px -4px 8px rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .neumorphic-inset {
            background: var(--card-gradient);
            border-radius: 12px;
            box-shadow: 
                inset 3px 3px 6px rgba(163, 177, 198, 0.2),
                inset -3px -3px 6px rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        /* Login Container */
        .login-container {
            max-width: 480px;
            margin: 50px auto;
            padding: 40px;
            background: var(--card-gradient);
            border-radius: 24px;
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.1),
                0 0 0 1px rgba(255, 255, 255, 0.5) inset;
            position: relative;
            overflow: hidden;
            z-index: 1;
        }
        
        .login-container::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                rgba(67, 97, 238, 0.05) 0%,
                rgba(76, 201, 240, 0.05) 100%
            );
            z-index: -1;
            transform: rotate(15deg);
        }
        
        .app-container {
            display: none;
        }
        
        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            padding: 20px 0;
            margin-bottom: 25px;
            box-shadow: 0 4px 20px rgba(67, 97, 238, 0.2);
            position: relative;
            overflow: hidden;
        }
        
        .header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-light), var(--success-color));
        }
        
        /* Cards */
        .card {
            border: none;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            margin-bottom: 20px;
            overflow: hidden;
            background: var(--card-gradient);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }
        
        .card-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            font-weight: 600;
            padding: 15px 20px;
            border-bottom: none;
            position: relative;
        }
        
        .card-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-light), var(--success-color));
        }
        
        .card-body {
            padding: 20px;
        }
        
        /* Tables */
        .table-responsive {
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }
        
        .table {
            margin-bottom: 0;
            font-size: 0.9rem;
            background: white;
        }
        
        .table th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: var(--text-dark);
            border-top: none;
            vertical-align: middle;
            white-space: nowrap;
            padding: 12px 15px;
        }
        
        .table td {
            vertical-align: middle;
            padding: 12px 15px;
            border-color: #f1f3f5;
        }
        
        .table tr:last-child td {
            border-bottom: none;
        }
        
        /* Loading Indicator */
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        
        .loading-content {
            background: var(--card-gradient);
            padding: 30px;
            border-radius: 16px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            max-width: 300px;
            width: 100%;
        }
        
        /* Badges */
        .badge {
            font-weight: 500;
            padding: 6px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            letter-spacing: 0.5px;
        }
        
        /* Month Selector */
        .month-selector {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
        }
        
        .month-display {
            font-size: 1.2rem;
            font-weight: bold;
            min-width: 180px;
            text-align: center;
            margin: 0 15px;
            color: var(--text-dark);
            background: var(--card-gradient);
            padding: 8px 20px;
            border-radius: 50px;
            box-shadow: 
                4px 4px 8px rgba(163, 177, 198, 0.2),
                -4px -4px 8px rgba(255, 255, 255, 0.7);
        }
        
        .month-btn {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            border: none;
            width: 42px;
            height: 42px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(67, 97, 238, 0.3);
        }
        
        .month-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 15px rgba(67, 97, 238, 0.4);
        }
        
        .month-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }
        
        /* Status Elements */
        .status-badge {
            display: inline-block;
            width: 24px;
            height: 24px;
            border-radius: 6px;
            text-align: center;
            line-height: 24px;
            font-weight: bold;
            color: white;
            font-size: 0.7rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .status-legend {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            background: var(--card-gradient);
            padding: 8px 14px;
            border-radius: 50px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            font-size: 0.85rem;
            transition: all 0.3s;
        }
        
        .status-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }
        
        .status-color {
            width: 18px;
            height: 18px;
            margin-right: 8px;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        /* Charts */
        .chart-container {
            position: relative;
            height: 280px;
            margin-bottom: 20px;
        }
        
        /* Payslip */
        .payslip {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 25px;
            font-family: 'Inter', sans-serif;
            position: relative;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .payslip-header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #eee;
        }
        
        .payslip-title {
            font-size: 1.4rem;
            font-weight: bold;
            margin-bottom: 8px;
            color: var(--primary-color);
        }
        
        .payslip-period {
            font-size: 1rem;
            margin-bottom: 10px;
            color: var(--text-light);
        }
        
        .payslip-section {
            margin-bottom: 20px;
        }
        
        .payslip-section-title {
            font-weight: bold;
            font-size: 1rem;
            margin-bottom: 12px;
            border-bottom: 1px solid #eee;
            padding-bottom: 6px;
            color: var(--primary-color);
        }
        
        .payslip-row {
            display: flex;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }
        
        .payslip-label {
            flex: 1;
            font-weight: 600;
            color: var(--text-dark);
        }
        
        .payslip-value {
            flex: 2;
            color: var(--text-dark);
        }
        
        .payslip-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 12px;
            font-size: 0.85rem;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        
        .payslip-table th {
            background-color: #f8f9fa;
            text-align: left;
            padding: 10px;
            border: 1px solid #eee;
            font-weight: 600;
        }
        
        .payslip-table td {
            padding: 10px;
            border: 1px solid #eee;
        }
        
        .payslip-table tr:last-child td {
            border-bottom: none;
        }
        
        .payslip-footer {
            margin-top: 25px;
            padding-top: 12px;
            border-top: 1px solid #eee;
            text-align: center;
            font-size: 0.8rem;
            color: var(--text-light);
        }
        
        .payslip-signature {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        .payslip-signature-line {
            width: 150px;
            border-top: 1px solid #333;
            text-align: center;
            padding-top: 5px;
            font-size: 0.85rem;
        }
        
        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.08);
            z-index: 1000;
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            backdrop-filter: blur(10px);
            background-color: rgba(255, 255, 255, 0.9);
        }
        
        .nav-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--text-light);
            text-decoration: none;
            font-size: 0.8rem;
            padding: 8px;
            border-radius: 12px;
            transition: all 0.3s;
            width: 100%;
            max-width: 80px;
            position: relative;
        }
        
        .nav-btn i {
            font-size: 1.4rem;
            margin-bottom: 5px;
            transition: all 0.3s;
        }
        
        .nav-btn.active {
            color: var(--primary-color);
            transform: translateY(-10px);
        }
        
        .nav-btn.active i {
            transform: scale(1.2);
        }
        
        .nav-btn.active::after {
            content: '';
            position: absolute;
            bottom: -8px;
            width: 6px;
            height: 6px;
            background: var(--primary-color);
            border-radius: 50%;
        }
        
        .tab-content {
            padding-bottom: 80px;
        }
        
        /* Employee Info Summary */
        .employee-summary {
            background: var(--card-gradient);
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            position: relative;
            overflow: hidden;
        }
        
        .employee-summary::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: linear-gradient(to bottom, var(--primary-color), var(--primary-light));
        }
        
        .employee-summary-row {
            display: flex;
            margin-bottom: 10px;
            font-size: 0.95rem;
        }
        
        .employee-summary-label {
            flex: 1;
            font-weight: 600;
            color: var(--text-light);
        }
        
        .employee-summary-value {
            flex: 2;
            font-weight: 500;
        }
        
        .absent-text {
            color: var(--danger-color);
            font-weight: bold;
        }
        
        /* Summary Cards */
        .summary-card {
            text-align: center;
            padding: 15px;
            border-radius: 12px;
            background: var(--card-gradient);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: all 0.3s;
        }
        
        .summary-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .summary-card .value {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .summary-card .label {
            font-size: 0.85rem;
            color: var(--text-light);
        }
        
        /* Buttons */
        .btn {
            border-radius: 50px;
            padding: 10px 20px;
            font-weight: 500;
            transition: all 0.3s;
            border: none;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(67, 97, 238, 0.3);
        }
        
        .btn-outline-light {
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(5px);
        }
        
        .btn-outline-light:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        /* Form Elements */
        .form-control {
            border-radius: 50px;
            padding: 12px 20px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            background: rgba(255, 255, 255, 0.8);
            transition: all 0.3s;
        }
        
        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(67, 97, 238, 0.25);
            background: white;
        }
        
        .form-check-input:checked {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        /* Modal */
        .modal-content {
            border-radius: 16px;
            border: none;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }
        
        .modal-header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            border-bottom: none;
            padding: 20px;
        }
        
        .modal-title {
            font-weight: 600;
        }
        
        .btn-close {
            filter: invert(1);
        }
        
        /* Floating Elements */
        .floating {
            animation: floating 3s ease-in-out infinite;
        }
        
        @keyframes floating {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        /* Print-specific styles */
        @media print {
            body * {
                visibility: hidden;
            }
            .payslip, .payslip * {
                visibility: visible;
            }
            .payslip {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                max-width: 100%;
                margin: 0;
                padding: 20px;
                border: none;
                background-color: white;
                page-break-after: always;
                box-shadow: none;
            }
            .no-print, .no-print * {
                display: none !important;
            }
        }
        
        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .login-container {
                padding: 30px;
                margin: 20px;
                border-radius: 20px;
            }
            
            .month-display {
                font-size: 1rem;
                min-width: 140px;
            }
            
            .month-btn {
                width: 36px;
                height: 36px;
            }
            
            .employee-summary-row {
                flex-direction: column;
            }
            
            .employee-summary-label,
            .employee-summary-value {
                flex: auto;
            }
            
            .employee-summary-label {
                margin-bottom: 2px;
            }
            
            .payslip-row {
                flex-direction: column;
            }
            
            .payslip-label,
            .payslip-value {
                flex: auto;
            }
            
            .payslip-label {
                margin-bottom: 2px;
            }
            
            .payslip-signature {
                flex-direction: column;
                align-items: center;
                gap: 20px;
            }
            
            .payslip-signature-line {
                width: 120px;
            }
            
            .nav-btn {
                max-width: 70px;
                font-size: 0.7rem;
            }
            
            .nav-btn i {
                font-size: 1.2rem;
            }
        }
        
        @media (max-width: 576px) {
            .login-container {
                padding: 25px;
                margin: 15px;
                border-radius: 18px;
            }
            
            .table {
                font-size: 0.8rem;
            }
            
            .table th, .table td {
                padding: 8px 10px;
            }
            
            .status-legend {
                gap: 8px;
            }
            
            .status-item {
                padding: 6px 10px;
                font-size: 0.75rem;
            }
            
            .month-display {
                font-size: 0.95rem;
                min-width: 120px;
                padding: 6px 15px;
            }
            
            .nav-btn {
                max-width: 60px;
                font-size: 0.65rem;
                padding: 6px;
            }
            
            .nav-btn i {
                font-size: 1.1rem;
            }
            
            .payslip-title {
                font-size: 1.2rem;
            }
            
            .payslip-period {
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Indicator -->
    <div class="loading">
        <div class="loading-content neumorphic">
            <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-3">Loading data...</p>
        </div>
    </div>

    <!-- Login Container -->
    <div class="login-container neumorphic" id="login-container">
        <div class="text-center mb-4">
            <div class="floating">
                <svg width="80" height="80" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" fill="url(#paint0_linear)"/>
                    <path d="M12 16C14.2091 16 16 14.2091 16 12C16 9.79086 14.2091 8 12 8C9.79086 8 8 9.79086 8 12C8 14.2091 9.79086 16 12 16Z" fill="white"/>
                    <path d="M12 13C12.5523 13 13 12.5523 13 12C13 11.4477 12.5523 11 12 11C11.4477 11 11 11.4477 11 12C11 12.5523 11.4477 13 12 13Z" fill="url(#paint1_linear)"/>
                    <defs>
                        <linearGradient id="paint0_linear" x1="2" y1="2" x2="22" y2="22" gradientUnits="userSpaceOnUse">
                            <stop stop-color="#4361ee"/>
                            <stop offset="1" stop-color="#4cc9f0"/>
                        </linearGradient>
                        <linearGradient id="paint1_linear" x1="11" y1="11" x2="13" y2="13" gradientUnits="userSpaceOnUse">
                            <stop stop-color="#4361ee"/>
                            <stop offset="1" stop-color="#4cc9f0"/>
                        </linearGradient>
                    </defs>
                </svg>
            </div>
            <h3 class="mt-3">Employee Portal</h3>
            <p class="text-muted">View your roster, attendance and payslips</p>
        </div>
        
        <form id="login-form">
            <div class="mb-3">
                <label for="employee-id" class="form-label">WE ONE ID or EK ID</label>
                <input type="text" class="form-control" id="employee-id" placeholder="Enter your ID" required>
            </div>
            <div class="mb-3 form-check">
                <input type="checkbox" class="form-check-input" id="remember-me">
                <label class="form-check-label" for="remember-me">Remember me</label>
            </div>
            <button type="submit" class="btn btn-primary w-100">Login</button>
        </form>
    </div>

    <!-- Main App Container -->
    <div class="app-container" id="app-container">
        <!-- Header -->
        <div class="header">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-8">
                        <h5 class="mb-0"><i class="fas fa-user-circle me-2"></i> <span id="employee-name"></span></h5>
                        <small class="text-white-50" id="employee-designation"></small>
                    </div>
                    <div class="col-4 text-end">
                        <button id="logout-btn" class="btn btn-sm btn-outline-light">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="container">
            <!-- Employee Summary -->
            <div class="employee-summary neumorphic">
                <div class="employee-summary-row">
                    <div class="employee-summary-label">WE ONE ID:</div>
                    <div class="employee-summary-value" id="info-weone-id"></div>
                </div>
                <div class="employee-summary-row">
                    <div class="employee-summary-label">Department:</div>
                    <div class="employee-summary-value" id="info-department"></div>
                </div>
                <div class="employee-summary-row">
                    <div class="employee-summary-label">Area:</div>
                    <div class="employee-summary-value" id="info-area"></div>
                </div>
            </div>

            <!-- Month Selector -->
            <div class="month-selector">
                <button id="prev-month-btn" class="month-btn" title="Previous Month">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <div id="month-display" class="month-display neumorphic-flat">April 2025</div>
                <button id="next-month-btn" class="month-btn" title="Next Month">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>

            <!-- Tab Content -->
            <div class="tab-content" id="employeeTabsContent">
                <!-- Roster Tab -->
                <div class="tab-pane fade show active" id="roster-tab-pane" role="tabpanel" aria-labelledby="roster-tab" tabindex="0">
                    <!-- Status Legend -->
                    <div class="status-legend">
                        <div class="status-item neumorphic-flat">
                            <div class="status-color" style="background-color: #e3f2fd;"></div>
                            <span>Vacation/Leave</span>
                        </div>
                        <div class="status-item neumorphic-flat">
                            <div class="status-color" style="background-color: #e8f5e9;"></div>
                            <span>Day Off</span>
                        </div>
                        <div class="status-item neumorphic-flat">
                            <div class="status-color" style="background-color: #ffebee;"></div>
                            <span>NB (06:00-19:00)</span>
                        </div>
                    </div>
                    
                    <div class="table-responsive neumorphic-flat">
                        <table class="table" id="roster-table">
                            <thead>
                                <tr>
                                    <th>Day</th>
                                    <th>Date</th>
                                    <th>Shift</th>
                                    <th>Status</th>
                                    <th>Scheduled Hours</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Roster data will be inserted here by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Attendance Tab -->
                <div class="tab-pane fade" id="attendance-tab-pane" role="tabpanel" aria-labelledby="attendance-tab" tabindex="0">
                    <div class="row">
                        <div class="col-md-3 col-6 mb-3">
                            <div class="summary-card neumorphic">
                                <div class="value text-primary" id="summary-days-worked">0</div>
                                <div class="label">Days Worked</div>
                            </div>
                        </div>
                        <div class="col-md-3 col-6 mb-3">
                            <div class="summary-card neumorphic">
                                <div class="value text-primary" id="summary-total-hours">0</div>
                                <div class="label">Total Hours</div>
                            </div>
                        </div>
                        <div class="col-md-3 col-6 mb-3">
                            <div class="summary-card neumorphic">
                                <div class="value text-primary" id="summary-days-off">0</div>
                                <div class="label">Days Off</div>
                            </div>
                        </div>
                        <div class="col-md-3 col-6 mb-3">
                            <div class="summary-card neumorphic">
                                <div class="value text-primary" id="summary-overtime">0 hrs</div>
                                <div class="label">Overtime</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card neumorphic">
                        <div class="card-header">
                            <i class="fas fa-table me-2"></i> Detailed Attendance
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table" id="attendance-table">
                                    <thead>
                                        <tr>
                                            <th>Day</th>
                                            <th>Date</th>
                                            <th>Shift</th>
                                            <th>Actual Hours</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Attendance data will be inserted here by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Payslip Tab -->
                <div class="tab-pane fade" id="payslip-tab-pane" role="tabpanel" aria-labelledby="payslip-tab" tabindex="0">
                    <div class="row">
                        <div class="col-md-3 col-6 mb-3">
                            <div class="summary-card neumorphic">
                                <div class="value text-success" id="salary-basic">AED 0</div>
                                <div class="label">Basic Salary</div>
                            </div>
                        </div>
                        <div class="col-md-3 col-6 mb-3">
                            <div class="summary-card neumorphic">
                                <div class="value text-success" id="salary-food">AED 0</div>
                                <div class="label">Food Allowance</div>
                            </div>
                        </div>
                        <div class="col-md-3 col-6 mb-3">
                            <div class="summary-card neumorphic">
                                <div class="value text-success" id="salary-work-nature">AED 0</div>
                                <div class="label">Work Nature</div>
                            </div>
                        </div>
                        <div class="col-md-3 col-6 mb-3">
                            <div class="summary-card neumorphic">
                                <div class="value text-success" id="salary-total">AED 0</div>
                                <div class="label">Net Salary</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="text-center mb-4">
                        <button class="btn btn-primary" id="view-payslip-btn">
                            <i class="fas fa-file-invoice me-2"></i> View Full Payslip
                        </button>
                    </div>
                    
                    <div class="card neumorphic">
                        <div class="card-header">
                            <i class="fas fa-chart-line me-2"></i> Monthly Summary
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table" id="monthly-summary-table">
                                    <thead>
                                        <tr>
                                            <th>Month</th>
                                            <th>Days</th>
                                            <th>Hours</th>
                                            <th>Salary</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Monthly summary data will be inserted here by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div class="bottom-nav no-print">
            <a href="#" class="nav-btn active" id="roster-nav-btn">
                <i class="fas fa-calendar-alt"></i>
                <span>Roster</span>
            </a>
            <a href="#" class="nav-btn" id="attendance-nav-btn">
                <i class="fas fa-calendar-check"></i>
                <span>Attendance</span>
            </a>
            <a href="#" class="nav-btn" id="payslip-nav-btn">
                <i class="fas fa-file-invoice-dollar"></i>
                <span>Payslip</span>
            </a>
        </div>
    </div>

    <!-- Payslip Modal -->
    <div class="modal fade" id="payslipModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Employee Payslip</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="payslipModalBody">
                    <!-- Payslip content will be inserted here by JavaScript -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="print-payslip-btn">
                        <i class="fas fa-print me-2"></i>Print Payslip
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    
    <script>
        // Initialize jsPDF
        const { jsPDF } = window.jspdf;
        
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBnJ0m0QnNyC4pnv-dBEgC3yiq65YPwZvM",
            authDomain: "weone-roster.firebaseapp.com",
            databaseURL: "https://weone-roster-default-rtdb.firebaseio.com",
            projectId: "weone-roster",
            storageBucket: "weone-roster.appspot.com",
            messagingSenderId: "335364720116",
            appId: "1:335364720116:web:ae669c448aba3788aca5a1",
            measurementId: "G-Z8MBXC4ZFR"
        };

        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const database = firebase.database();
        
        // DOM elements
        const loadingDiv = document.querySelector('.loading');
        const loginContainer = document.getElementById('login-container');
        const appContainer = document.getElementById('app-container');
        const loginForm = document.getElementById('login-form');
        const employeeIdInput = document.getElementById('employee-id');
        const rememberMe = document.getElementById('remember-me');
        const logoutBtn = document.getElementById('logout-btn');
        const employeeName = document.getElementById('employee-name');
        const employeeDesignation = document.getElementById('employee-designation');
        const infoWeoneId = document.getElementById('info-weone-id');
        const infoDepartment = document.getElementById('info-department');
        const infoArea = document.getElementById('info-area');
        const summaryDaysWorked = document.getElementById('summary-days-worked');
        const summaryTotalHours = document.getElementById('summary-total-hours');
        const summaryDaysOff = document.getElementById('summary-days-off');
        const summaryOvertime = document.getElementById('summary-overtime');
        const salaryBasic = document.getElementById('salary-basic');
        const salaryFood = document.getElementById('salary-food');
        const salaryWorkNature = document.getElementById('salary-work-nature');
        const salaryTotal = document.getElementById('salary-total');
        const viewPayslipBtn = document.getElementById('view-payslip-btn');
        const prevMonthBtn = document.getElementById('prev-month-btn');
        const nextMonthBtn = document.getElementById('next-month-btn');
        const monthDisplay = document.getElementById('month-display');
        const rosterTable = document.getElementById('roster-table');
        const rosterTableBody = rosterTable.querySelector('tbody');
        const attendanceTable = document.getElementById('attendance-table');
        const attendanceTableBody = attendanceTable.querySelector('tbody');
        const monthlySummaryTable = document.getElementById('monthly-summary-table');
        const monthlySummaryTableBody = monthlySummaryTable.querySelector('tbody');
        const payslipModal = new bootstrap.Modal(document.getElementById('payslipModal'));
        const payslipModalBody = document.getElementById('payslipModalBody');
        const printPayslipBtn = document.getElementById('print-payslip-btn');
        
        // Navigation buttons
        const rosterNavBtn = document.getElementById('roster-nav-btn');
        const attendanceNavBtn = document.getElementById('attendance-nav-btn');
        const payslipNavBtn = document.getElementById('payslip-nav-btn');
        const rosterTabPane = document.getElementById('roster-tab-pane');
        const attendanceTabPane = document.getElementById('attendance-tab-pane');
        const payslipTabPane = document.getElementById('payslip-tab-pane');

        // Global variables
        let currentEmployee = null;
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        let employeeData = {};
        let rosterData = [];
        let attendanceData = {};
        let salaryData = {};
        let monthlyStats = [];
        let departmentShiftKeys = {}; // To store shift keys for the department
        let attendanceChart = null;
        let hoursChart = null;
        let shiftChart = null;
        const monthNames = ["JANUARY", "FEBRUARY", "MARCH", "APRIL", "MAY", "JUNE", "JULY", "AUGUST", "SEPTEMBER", "OCTOBER", "NOVEMBER", "DECEMBER"];
        
        // Default status options with colors and shift hours
        const defaultStatusOptions = {
            'VI': { color: '#e3f2fd', description: 'Vacation/Leave', hours: 0 },
            'VJ': { color: '#fff8e1', description: 'Vacation/Job', hours: 0 },
            'YY': { color: '#e8f5e9', description: 'Day Off', hours: 0 },
            'NB': { color: '#ffebee', description: 'NB (06:00-19:00)', hours: 13 },
            'DF': { color: '#f3e5f5', description: 'DF (18:00-07:00)', hours: 13 },
            'EX': { color: '#e0f7fa', description: 'EX (08:00-20:00)', hours: 12 },
            'NR': { color: '#fff3e0', description: 'NR (20:00-08:00)', hours: 12 },
            'DX': { color: '#e8eaf6', description: 'DX (09:00-21:00)', hours: 12 },
            'NI': { color: '#f1f8e9', description: 'NI (21:00-09:00)', hours: 12 },
            'TT': { color: '#e8f5e9', description: '12:00-00:00', hours: 12 }
        };

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            checkRememberedLogin();
            setupEventListeners();
        });

        function checkRememberedLogin() {
            const rememberedId = localStorage.getItem('rememberedEmployeeId');
            if (rememberedId) {
                employeeIdInput.value = rememberedId;
                rememberMe.checked = true;
            }
        }

        function showLoading() {
            loadingDiv.style.display = 'flex';
        }

        function hideLoading() {
            loadingDiv.style.display = 'none';
        }

        function updateMonthDisplay() {
            monthDisplay.textContent = `${monthNames[currentMonth]} ${currentYear}`;
            
            // Disable previous month button if we're at the earliest possible month
            const earliestMonth = new Date(2023, 0, 1); // January 2023 as earliest
            const currentDate = new Date(currentYear, currentMonth, 1);
            prevMonthBtn.disabled = currentDate <= earliestMonth;
        }

        function switchToPreviousMonth() {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            
            showLoading();
            loadEmployeeData().then(() => {
                updateUI();
                hideLoading();
            });
        }

        function switchToNextMonth() {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            
            showLoading();
            loadEmployeeData().then(() => {
                updateUI();
                hideLoading();
            });
        }

        function loadEmployeeData() {
            return new Promise((resolve) => {
                const monthYearKey = `${monthNames[currentMonth]}-${currentYear}`;
                
                // Load employee master data
                database.ref('employees').once('value').then((snapshot) => {
                    const allEmployees = snapshot.val();
                    
                    // Find employee by WE ONE ID or EK ID
                    let foundEmployee = null;
                    let department = null;
                    
                    Object.keys(allEmployees).forEach(dept => {
                        Object.keys(allEmployees[dept]).forEach(empId => {
                            const emp = allEmployees[dept][empId];
                            if (emp.weoneId === currentEmployee || emp.ekId === currentEmployee) {
                                foundEmployee = emp;
                                department = dept;
                            }
                        });
                    });
                    
                    if (!foundEmployee) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: 'Employee not found. Please check your ID and try again.'
                        });
                        logout();
                        resolve();
                        return;
                    }
                    
                    employeeData = foundEmployee;
                    employeeData.department = department;
                    
                    // Load department shift keys
                    database.ref(`departments/${department}/shiftKeys`).once('value').then((shiftKeysSnapshot) => {
                        const shiftKeys = shiftKeysSnapshot.val();
                        departmentShiftKeys = {};
                        
                        if (shiftKeys) {
                            shiftKeys.forEach(shift => {
                                departmentShiftKeys[shift.value] = {
                                    description: shift.description,
                                    color: shift.color || defaultStatusOptions[shift.value]?.color || '#e8f5e9',
                                    hours: shift.hours || defaultStatusOptions[shift.value]?.hours || 0
                                };
                            });
                        }
                        
                        // Load roster data
                        database.ref(`rosters/${department}/${monthYearKey}/${employeeData.weoneId}`).once('value').then((rosterSnapshot) => {
                            const rosterDataFromDB = rosterSnapshot.val();
                            
                            if (rosterDataFromDB) {
                                rosterData = rosterDataFromDB.days || [];
                            } else {
                                rosterData = [];
                            }
                            
                            // Load attendance data
                            database.ref(`attendance/${department}/${monthYearKey}/${employeeData.weoneId}`).once('value').then((attendanceSnapshot) => {
                                const attendanceDataFromDB = attendanceSnapshot.val();
                                attendanceData = {};
                                
                                if (attendanceDataFromDB) {
                                    // Convert the attendance data from object with numeric keys to array
                                    Object.keys(attendanceDataFromDB).forEach(dayIndex => {
                                        attendanceData[parseInt(dayIndex)] = attendanceDataFromDB[dayIndex];
                                    });
                                }
                                
                                // Load salary data
                                database.ref(`salaries/${department}/${monthYearKey}/${employeeData.weoneId}`).once('value').then((salarySnapshot) => {
                                    salaryData = salarySnapshot.val() || {};
                                    
                                    // Load salary settings for this designation
                                    database.ref(`salarySettings/${department}/${employeeData.designation}`).once('value').then((settingsSnapshot) => {
                                        const settings = settingsSnapshot.val();
                                        
                                        if (settings) {
                                            // If no salary data exists, initialize with settings
                                            if (!salaryData.basicSalary) {
                                                salaryData.basicSalary = settings.basicSalary || 2000;
                                                salaryData.foodAllowance = settings.foodAllowance || 300;
                                                salaryData.workNatureAllowance = settings.workNatureAllowance || 200;
                                            }
                                        }
                                        
                                        // Load monthly stats
                                        loadMonthlyStats().then(() => {
                                            resolve();
                                        });
                                    }).catch(() => {
                                        // If no settings found, use defaults
                                        if (!salaryData.basicSalary) {
                                            salaryData.basicSalary = 2000;
                                            salaryData.foodAllowance = 300;
                                            salaryData.workNatureAllowance = 200;
                                        }
                                        
                                        loadMonthlyStats().then(() => {
                                            resolve();
                                        });
                                    });
                                }).catch((error) => {
                                    console.error("Error loading salary data:", error);
                                    salaryData = {};
                                    loadMonthlyStats().then(() => {
                                        resolve();
                                    });
                                });
                            }).catch((error) => {
                                console.error("Error loading attendance data:", error);
                                attendanceData = {};
                                salaryData = {};
                                loadMonthlyStats().then(() => {
                                    resolve();
                                });
                            });
                        }).catch((error) => {
                            console.error("Error loading roster data:", error);
                            rosterData = [];
                            attendanceData = {};
                            salaryData = {};
                            loadMonthlyStats().then(() => {
                                resolve();
                            });
                        });
                    }).catch((error) => {
                        console.error("Error loading shift keys:", error);
                        // Continue with default shift keys
                        departmentShiftKeys = {};
                        
                        // Load roster data
                        database.ref(`rosters/${department}/${monthYearKey}/${employeeData.weoneId}`).once('value').then((rosterSnapshot) => {
                            const rosterDataFromDB = rosterSnapshot.val();
                            
                            if (rosterDataFromDB) {
                                rosterData = rosterDataFromDB.days || [];
                            } else {
                                rosterData = [];
                            }
                            
                            // Load attendance data
                            database.ref(`attendance/${department}/${monthYearKey}/${employeeData.weoneId}`).once('value').then((attendanceSnapshot) => {
                                const attendanceDataFromDB = attendanceSnapshot.val();
                                attendanceData = {};
                                
                                if (attendanceDataFromDB) {
                                    // Convert the attendance data from object with numeric keys to array
                                    Object.keys(attendanceDataFromDB).forEach(dayIndex => {
                                        attendanceData[parseInt(dayIndex)] = attendanceDataFromDB[dayIndex];
                                    });
                                }
                                
                                // Load salary data
                                database.ref(`salaries/${department}/${monthYearKey}/${employeeData.weoneId}`).once('value').then((salarySnapshot) => {
                                    salaryData = salarySnapshot.val() || {};
                                    
                                    // Load salary settings for this designation
                                    database.ref(`salarySettings/${department}/${employeeData.designation}`).once('value').then((settingsSnapshot) => {
                                        const settings = settingsSnapshot.val();
                                        
                                        if (settings) {
                                            // If no salary data exists, initialize with settings
                                            if (!salaryData.basicSalary) {
                                                salaryData.basicSalary = settings.basicSalary || 2000;
                                                salaryData.foodAllowance = settings.foodAllowance || 300;
                                                salaryData.workNatureAllowance = settings.workNatureAllowance || 200;
                                            }
                                        }
                                        
                                        // Load monthly stats
                                        loadMonthlyStats().then(() => {
                                            resolve();
                                        });
                                    }).catch(() => {
                                        // If no settings found, use defaults
                                        if (!salaryData.basicSalary) {
                                            salaryData.basicSalary = 2000;
                                            salaryData.foodAllowance = 300;
                                            salaryData.workNatureAllowance = 200;
                                        }
                                        
                                        loadMonthlyStats().then(() => {
                                            resolve();
                                        });
                                    });
                                }).catch((error) => {
                                    console.error("Error loading salary data:", error);
                                    salaryData = {};
                                    loadMonthlyStats().then(() => {
                                        resolve();
                                    });
                                });
                            }).catch((error) => {
                                console.error("Error loading attendance data:", error);
                                attendanceData = {};
                                salaryData = {};
                                loadMonthlyStats().then(() => {
                                    resolve();
                                });
                            });
                        }).catch((error) => {
                            console.error("Error loading roster data:", error);
                            rosterData = [];
                            attendanceData = {};
                            salaryData = {};
                            loadMonthlyStats().then(() => {
                                resolve();
                            });
                        });
                    });
                }).catch((error) => {
                    console.error("Error loading employee data:", error);
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Failed to load employee data. Please try again.'
                    });
                    resolve();
                });
            });
        }

        function loadMonthlyStats() {
            return new Promise((resolve) => {
                monthlyStats = [];
                const promises = [];
                
                // Get data for last 12 months
                for (let i = 0; i < 12; i++) {
                    const date = new Date(currentYear, currentMonth - i, 1);
                    const month = date.getMonth();
                    const year = date.getFullYear();
                    const monthYearKey = `${monthNames[month]}-${year}`;
                    
                    promises.push(
                        database.ref(`salaries/${employeeData.department}/${monthYearKey}/${employeeData.weoneId}`).once('value').then((snapshot) => {
                            const data = snapshot.val();
                            if (data) {
                                monthlyStats.push({
                                    month,
                                    year,
                                    daysWorked: data.daysWorked || 0,
                                    totalHours: data.totalHours || 0,
                                    overtime: data.overtime || 0,
                                    total: data.total || 0
                                });
                            }
                        }).catch(() => {
                            // Ignore errors for months with no data
                        })
                    );
                }
                
                Promise.all(promises).then(() => {
                    // Sort by year and month (newest first)
                    monthlyStats.sort((a, b) => {
                        if (a.year !== b.year) return b.year - a.year;
                        return b.month - a.month;
                    });
                    resolve();
                });
            });
        }

        function updateUI() {
            updateMonthDisplay();
            
            // Update employee info
            employeeName.textContent = employeeData.name || '';
            employeeDesignation.textContent = employeeData.designation || '';
            infoWeoneId.textContent = employeeData.weoneId || '';
            infoDepartment.textContent = employeeData.department || '';
            infoArea.textContent = employeeData.area || '';
            
            // Calculate current month stats
            calculateCurrentMonthStats();
            
            // Update salary info
            salaryBasic.textContent = `AED ${(salaryData.basicSalary || 0).toFixed(2)}`;
            salaryFood.textContent = `AED ${(salaryData.foodAllowance || 0).toFixed(2)}`;
            salaryWorkNature.textContent = `AED ${(salaryData.workNatureAllowance || 0).toFixed(2)}`;
            
            const totalEarnings = (salaryData.basicSalary || 0) + 
                                 (salaryData.foodAllowance || 0) + 
                                 (salaryData.workNatureAllowance || 0) + 
                                 (salaryData.overtime || 0) + 
                                 (salaryData.specialReward || 0);
            const totalDeductions = (salaryData.eidDeduction || 0) + 
                                   (salaryData.advancedSalary || 0);
            const netSalary = totalEarnings - totalDeductions;
            
            salaryTotal.textContent = `AED ${netSalary.toFixed(2)}`;
            
            // Render tables
            renderRosterTable();
            renderAttendanceTable();
            renderMonthlySummaryTable();
        }

        function calculateCurrentMonthStats() {
            let daysWorked = 0;
            let totalHours = 0;
            let daysOff = 0;
            let absents = 0;
            let overtimeHours = 0;
            
            // Calculate from roster and attendance data
            if (rosterData && rosterData.length > 0) {
                rosterData.forEach((status, dayIndex) => {
                    // Get shift info from department shift keys or use default
                    let shiftInfo = departmentShiftKeys[status] || defaultStatusOptions[status] || {
                        description: status,
                        color: '#e8f5e9',
                        hours: 0
                    };
                    
                    // Check for days off (shifts with 0 hours)
                    if (shiftInfo.hours === 0) {
                        daysOff++;
                        return;
                    }
                    
                    // Check attendance data for this day
                    const attendanceRecord = attendanceData[dayIndex];
                    const hours = parseFloat(attendanceRecord?.hours) || 0;
                    
                    if (attendanceRecord) {
                        if (hours > 0) {
                            daysWorked++;
                            totalHours += hours;
                            
                            // Calculate overtime (simplified - any hours over 8 is overtime)
                            if (hours > 8) {
                                overtimeHours += (hours - 8);
                            }
                        } else {
                            absents++;
                        }
                    } else {
                        // No attendance record - assume absent
                        absents++;
                    }
                });
            }
            
            // Update summary cards
            summaryDaysWorked.textContent = daysWorked;
            summaryTotalHours.textContent = totalHours.toFixed(1);
            summaryDaysOff.textContent = daysOff;
            summaryOvertime.textContent = `${overtimeHours.toFixed(1)} hrs`;
            
            // Update salary data with calculated values
            salaryData.daysWorked = daysWorked;
            salaryData.totalHours = totalHours;
            salaryData.overtime = overtimeHours * (salaryData.basicSalary / 200); // Assuming 200 hours is full month
        }

        function renderRosterTable() {
            rosterTableBody.innerHTML = '';
            
            if (!rosterData || rosterData.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="5" class="text-center">No roster data available for this month</td>';
                rosterTableBody.appendChild(row);
                return;
            }
            
            // Get number of days in current month
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            
            for (let i = 0; i < daysInMonth; i++) {
                const date = new Date(currentYear, currentMonth, i + 1);
                const dayName = dayNames[date.getDay()];
                const status = rosterData[i] || 'YY';
                
                // Get shift info from department shift keys or use default
                let shiftInfo = departmentShiftKeys[status] || defaultStatusOptions[status] || {
                    description: status,
                    color: '#e8f5e9',
                    hours: 0
                };
                
                // Get scheduled hours from shift info
                const scheduledHours = shiftInfo.hours || 0;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${dayName}</td>
                    <td>${i + 1}</td>
                    <td>${shiftInfo.description}</td>
                    <td class="status-cell" style="background-color: ${shiftInfo.color}">
                        ${status}
                    </td>
                    <td>${scheduledHours}</td>
                `;
                
                rosterTableBody.appendChild(row);
            }
        }

        function renderAttendanceTable() {
            attendanceTableBody.innerHTML = '';
            
            if (!rosterData || rosterData.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="5" class="text-center">No attendance data available for this month</td>';
                attendanceTableBody.appendChild(row);
                return;
            }
            
            // Get number of days in current month
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            
            for (let i = 0; i < daysInMonth; i++) {
                const date = new Date(currentYear, currentMonth, i + 1);
                const dayName = dayNames[date.getDay()];
                const status = rosterData[i] || 'YY';
                
                // Get shift info from department shift keys or use default
                let shiftInfo = departmentShiftKeys[status] || defaultStatusOptions[status] || {
                    description: status,
                    color: '#e8f5e9',
                    hours: 0
                };
                
                // Skip days off (shifts with 0 hours)
                if (shiftInfo.hours === 0) continue;
                
                // Get attendance record for this day
                const attendanceRecord = attendanceData[i];
                const hours = parseFloat(attendanceRecord?.hours) || 0;
                let attendanceStatus = hours > 0 ? 'Present' : '<span class="absent-text">Absent</span>';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${dayName}</td>
                    <td>${i + 1}</td>
                    <td>${shiftInfo.description}</td>
                    <td>${hours.toFixed(1)}</td>
                    <td>${attendanceStatus}</td>
                `;
                
                attendanceTableBody.appendChild(row);
            }
            
            if (attendanceTableBody.children.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="5" class="text-center">No working days this month</td>';
                attendanceTableBody.appendChild(row);
            }
        }

        function renderMonthlySummaryTable() {
            monthlySummaryTableBody.innerHTML = '';
            
            if (monthlyStats.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="4" class="text-center">No salary data available</td>';
                monthlySummaryTableBody.appendChild(row);
                return;
            }
            
            monthlyStats.forEach(stat => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${monthNames[stat.month].substring(0, 3)} ${stat.year}</td>
                    <td>${stat.daysWorked}</td>
                    <td>${stat.totalHours.toFixed(1)}</td>
                    <td>AED ${stat.total.toFixed(2)}</td>
                `;
                monthlySummaryTableBody.appendChild(row);
            });
        }

        function showPayslip() {
            if (!salaryData.basicSalary) {
                Swal.fire({
                    icon: 'warning',
                    title: 'No Salary Data',
                    text: 'Salary information is not available for this month.'
                });
                return;
            }
            
            const monthYear = `${monthNames[currentMonth]} ${currentYear}`;
            
            // Calculate net pay
            const totalEarnings = (salaryData.basicSalary || 0) + 
                                 (salaryData.foodAllowance || 0) + 
                                 (salaryData.workNatureAllowance || 0) + 
                                 (salaryData.overtime || 0) + 
                                 (salaryData.specialReward || 0);
            const totalDeductions = (salaryData.eidDeduction || 0) + 
                                   (salaryData.advancedSalary || 0);
            const netPay = totalEarnings - totalDeductions;
            
            payslipModalBody.innerHTML = `
                <div class="payslip">
                    <div class="payslip-header">
                        <div class="payslip-title">PAYROLL INFORMATION</div>
                        <div class="payslip-period">Payment Period: ${monthYear}</div>
                    </div>
                    
                    <div class="payslip-section">
                        <div class="payslip-section-title">Personal Information</div>
                        <div class="payslip-row">
                            <div class="payslip-label">Employee Name</div>
                            <div class="payslip-value">${employeeData.name || ''}</div>
                        </div>
                        <div class="payslip-row">
                            <div class="payslip-label">Employee Number</div>
                            <div class="payslip-value">${employeeData.weoneId || ''}</div>
                        </div>
                        <div class="payslip-row">
                            <div class="payslip-label">Organization</div>
                            <div class="payslip-value">WeOne</div>
                        </div>
                        <div class="payslip-row">
                            <div class="payslip-label">Position</div>
                            <div class="payslip-value">${employeeData.designation || ''}</div>
                        </div>
                    </div>
                    
                    <div class="payslip-section">
                        <div class="payslip-section-title">Summary of Payment</div>
                        <table class="payslip-table">
                            <tr>
                                <th>Total Earnings</th>
                                <th>Total Deductions</th>
                                <th>Net Pay</th>
                            </tr>
                            <tr>
                                <td>AED ${totalEarnings.toFixed(2)}</td>
                                <td>AED ${totalDeductions.toFixed(2)}</td>
                                <td>AED ${netPay.toFixed(2)}</td>
                            </tr>
                        </table>
                    </div>
                    
                    <div class="payslip-section">
                        <div class="payslip-section-title">Earnings</div>
                        <table class="payslip-table">
                            <tr>
                                <th>Description</th>
                                <th>Amount</th>
                                <th>Description</th>
                                <th>Amount</th>
                            </tr>
                            <tr>
                                <td>Basic Salary</td>
                                <td>AED ${(salaryData.basicSalary || 0).toFixed(2)}</td>
                                <td>EID Charges</td>
                                <td>AED ${(salaryData.eidDeduction || 0).toFixed(2)}</td>
                            </tr>
                            <tr>
                                <td>Food Allowance</td>
                                <td>AED ${(salaryData.foodAllowance || 0).toFixed(2)}</td>
                                <td>Advanced Salary</td>
                                <td>AED ${(salaryData.advancedSalary || 0).toFixed(2)}</td>
                            </tr>
                            <tr>
                                <td>Work Nature Allowance</td>
                                <td>AED ${(salaryData.workNatureAllowance || 0).toFixed(2)}</td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>Overtime</td>
                                <td>AED ${(salaryData.overtime || 0).toFixed(2)}</td>
                                <td>Total Deductions</td>
                                <td>AED ${totalDeductions.toFixed(2)}</td>
                            </tr>
                            <tr>
                                <td>Special Reward</td>
                                <td>AED ${(salaryData.specialReward || 0).toFixed(2)}</td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr class="total-row">
                                <td>Total Earnings</td>
                                <td>AED ${totalEarnings.toFixed(2)}</td>
                                <td></td>
                                <td></td>
                            </tr>
                        </table>
                    </div>
                    
                    <div class="payslip-section">
                        <div class="payslip-section-title">Information</div>
                        <table class="payslip-table">
                            <tr>
                                <th>Description</th>
                                <th>Input Value</th>
                                <th>Value</th>
                            </tr>
                            <tr>
                                <td>Annual Leave Balance</td>
                                <td>Number of Days</td>
                                <td>34.08</td>
                            </tr>
                            <tr>
                                <td>Annual Leave Balance</td>
                                <td>Credited Upto</td>
                                <td>31-03-2025</td>
                            </tr>
                            <tr>
                                <td>Overtime</td>
                                <td>Normal Hours</td>
                                <td>${(salaryData.overtime / (salaryData.basicSalary / 200)).toFixed(2)}</td>
                            </tr>
                        </table>
                    </div>
                    
                    <div class="payslip-section">
                        <div class="payslip-section-title">Payment Information</div>
                        <table class="payslip-table">
                            <tr>
                                <th>Method</th>
                                <th>Bank Name</th>
                                <th>Branch Name</th>
                                <th>Account Number</th>
                                <th>Amount</th>
                            </tr>
                            <tr>
                                <td>Bank Transfer</td>
                                <td>EMIRATES NBD</td>
                                <td>DUBAI</td>
                                <td>••••••••••••••••6951</td>
                                <td>AED ${netPay.toFixed(2)}</td>
                            </tr>
                            <tr class="total-row">
                                <td colspan="4">Total</td>
                                <td>AED ${netPay.toFixed(2)}</td>
                            </tr>
                        </table>
                    </div>
                    
                    <div class="payslip-footer">
                        <p>This is a computer generated payslip and does not require a signature.</p>
                        <p>Printed on: ${new Date().toLocaleDateString()}</p>
                    </div>
                </div>
            `;
            
            payslipModal.show();
        }

        function printCurrentPayslip() {
            const payslipContent = payslipModalBody.innerHTML;
            const originalContent = document.body.innerHTML;
            
            document.body.innerHTML = payslipContent;
            window.print();
            document.body.innerHTML = originalContent;
            
            // Reinitialize event listeners
            setupEventListeners();
            
            // Re-show the payslip modal
            payslipModal.show();
        }

        function login() {
            const employeeId = employeeIdInput.value.trim();
            
            if (!employeeId) {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Please enter your WE ONE ID or EK ID'
                });
                return;
            }
            
            showLoading();
            
            // Check if employee exists
            database.ref('employees').once('value').then((snapshot) => {
                const allEmployees = snapshot.val();
                let foundEmployee = null;
                
                Object.keys(allEmployees).forEach(dept => {
                    Object.keys(allEmployees[dept]).forEach(empId => {
                        const emp = allEmployees[dept][empId];
                        if (emp.weoneId === employeeId || emp.ekId === employeeId) {
                            foundEmployee = emp;
                        }
                    });
                });
                
                if (!foundEmployee) {
                    hideLoading();
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'Employee not found. Please check your ID and try again.'
                    });
                    return;
                }
                
                // Remember login if checkbox is checked
                if (rememberMe.checked) {
                    localStorage.setItem('rememberedEmployeeId', employeeId);
                } else {
                    localStorage.removeItem('rememberedEmployeeId');
                }
                
                // Set current employee and load data
                currentEmployee = employeeId;
                loginContainer.style.display = 'none';
                appContainer.style.display = 'block';
                
                loadEmployeeData().then(() => {
                    updateUI();
                    hideLoading();
                });
            }).catch((error) => {
                hideLoading();
                console.error("Error loading employee data:", error);
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: 'Failed to load employee data. Please try again.'
                });
            });
        }

        function logout() {
            currentEmployee = null;
            employeeData = {};
            rosterData = [];
            attendanceData = {};
            salaryData = {};
            monthlyStats = [];
            departmentShiftKeys = {};
            
            loginContainer.style.display = 'flex';
            appContainer.style.display = 'none';
            
            // Reset form
            loginForm.reset();
        }

        function switchTab(tabName) {
            // Hide all tab panes
            rosterTabPane.classList.remove('show', 'active');
            attendanceTabPane.classList.remove('show', 'active');
            payslipTabPane.classList.remove('show', 'active');
            
            // Remove active class from all nav buttons
            rosterNavBtn.classList.remove('active');
            attendanceNavBtn.classList.remove('active');
            payslipNavBtn.classList.remove('active');
            
            // Show selected tab and mark button as active
            switch(tabName) {
                case 'roster':
                    rosterTabPane.classList.add('show', 'active');
                    rosterNavBtn.classList.add('active');
                    break;
                case 'attendance':
                    attendanceTabPane.classList.add('show', 'active');
                    attendanceNavBtn.classList.add('active');
                    break;
                case 'payslip':
                    payslipTabPane.classList.add('show', 'active');
                    payslipNavBtn.classList.add('active');
                    break;
            }
        }

        function setupEventListeners() {
            // Login form
            loginForm.addEventListener('submit', function(e) {
                e.preventDefault();
                login();
            });
            
            // Logout button
            logoutBtn.addEventListener('click', logout);
            
            // Month navigation buttons
            prevMonthBtn.addEventListener('click', switchToPreviousMonth);
            nextMonthBtn.addEventListener('click', switchToNextMonth);
            
            // View payslip button
            viewPayslipBtn.addEventListener('click', showPayslip);
            
            // Print payslip button
            printPayslipBtn.addEventListener('click', printCurrentPayslip);
            
            // Navigation buttons
            rosterNavBtn.addEventListener('click', function(e) {
                e.preventDefault();
                switchTab('roster');
            });
            
            attendanceNavBtn.addEventListener('click', function(e) {
                e.preventDefault();
                switchTab('attendance');
            });
            
            payslipNavBtn.addEventListener('click', function(e) {
                e.preventDefault();
                switchTab('payslip');
            });
        }
    </script>
</body>
</html>
